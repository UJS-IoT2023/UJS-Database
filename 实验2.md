# 实验二

## 实验目的

掌握查询语句

## 实验要求

1. 检索上海产的零件的工程名称；

2. 检索供应工程J1零件P1的供应商号SNO；

3. 检索供应工程J1零件为红色的供应商号SNO；

4. 检索没有使用天津生产的红色零件的工程号JNO；

5. 检索至少用了供应商S1所供应的全部零件的工程号JNO；

6. 检索购买了零件P1的工程项目号JNO及数量QTY，并要求对查询的结果按数量QTY降序排列。

## 实验步骤

**查询工程名称**

```sql
SELECT DISTINCT p.project_name
FROM projects p
JOIN supplier_part_project spj ON j.project_id = spj.project_id
JOIN suppliers s ON spj.supplier_id = s.supplier_id
WHERE s.city = '上海';
```

| project\_name |
|:------------- |
| 一汽            |
| 三建            |
| 造船厂           |

**检索供应工程零件的供应商号**

```sql
SELECT supplier_id
FROM supplier_part_project
WHERE project_id = 'J1' AND part_id = 'P1';
```

| supplier\_id |
|:------------ |
| S1           |
| S3           |

**检索工程J1的红色零件的供应商号**

```sql
SELECT DISTINCT spp.supplier_id
FROM supplier_part_project spp
JOIN parts p ON spp.part_id = p.part_id
WHERE spp.project_id = 'J1' AND p.color = '红';
```

| supplier\_id |
|:------------ |
| S1           |
| S3           |

**检索没有使用天津生产的红色零件工程号**

```sql
SELECT project_id FROM projects
WHERE project_id NOT IN (
    SELECT DISTINCT spp.project_id
    FROM supplier_part_project spp
    JOIN suppliers s ON spp.supplier_id = s.supplier_id
    JOIN parts p ON spp.part_id = p.part_id
    WHERE s.city = '天津' AND p.color = '红'
    );
```

| project\_id |
|:----------- |
| J2          |
| J5          |
| J6          |
| J7          |

**检索至少使用S1供应商的全部零件的工程号**

```sql
SELECT DISTINCT j.project_id
FROM projects j
WHERE NOT EXISTS (
    SELECT p.part_id
    FROM supplier_part_project p
    WHERE p.supplier_id = 'S1'
      AND NOT EXISTS (
          SELECT *
          FROM supplier_part_project spj
          WHERE spj.project_id = j.project_id
            AND spj.part_id = p.part_id
      )
);
```

| project\_id |
|:----------- |
| J4          |

**检索购买了零件P1的工程项目号JNO及数量QTY，并要求对查询的结果按数量QTY降序排列。**

```sql
SELECT project_id, quantity
FROM supplier_part_project
WHERE part_id = 'P1'
ORDER BY quantity DESC;
```

| project\_id | quantity |
|:----------- |:-------- |
| J4          | 700      |
| J1          | 200      |
| J1          | 200      |
| J3          | 100      |

## 实验小结

1. 如何提高数据查询和连接速度
   
   - 为常用连接字段建立索引
   
   - 优化查询语句结构（在LINQ等开发中常为自动）
   
   - 使用视图减少重复查询
   
   - 限制返回结果

2. 比较连接查询和嵌套查询
   
   连接查询适合处理多表联合，效率高、结构清晰；嵌套查询逻辑简单，易读但性能较低。
   
   在大多数情况下，`JOIN` 查询执行速度更快，而 `EXISTS`/`IN` 子查询更适合存在性判断。
