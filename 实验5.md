# 实验五 数据库的定于与建立

## 实验内容

1. 创建响应的数据库和查看数据库属性；

2. 创建基本表、确定表的主码和相应的约束，为主码建立索引；

3. 创建，查看视图。

**数据库定义与种子数据**

**图书馆** **library**

| **library_id** | library_name | **city** | **tel** |
| -------------- | ------------ | -------- | ------- |
| L1             | 上海图书馆        | 上海       | 205800  |
| L2             | 上海外文书店       | 上海       | 310310  |
| L3             | 北京图书馆        | 北京       | 282471  |
| L4             | 武汉图书馆        | 武汉       | 812712  |
| L5             | 南京图书馆        | 南京       | 328173  |

**图书** **book**

| **book_id** | **book_name** | **price** |
| ----------- | ------------- | --------- |
| B1          | 数据库原理         | 9.80      |
| B2          | 系统分析与设计       | 8.50      |
| B3          | 数据库设计         | 7.10      |
| B4          | 计算机原理         | 9.60      |
| B5          | 操作系统          | 11.20     |

**书店** **shop**

| **shop_id** | **shop_name** | **address** |
| ----------- | ------------- | ----------- |
| S1          | 北京新华书店        | 北京          |
| S2          | 上海新华书店        | 上海          |
| S3          | 上海外文书店        | 上海          |
| S4          | 湖北新华书店        | 武汉          |
| S5          | 江苏新华书店        | 南京          |

**图书发行** **book_distribution**

| **library_id** | **book_id** | **shop_id** | **quantity** |
| -------------- | ----------- | ----------- | ------------ |
| L1             | B1          | S2          | 10           |
| L1             | B2          | S1          | 5            |
| L1             | B3          | S3          | 5            |
| L1             | B4          | S5          | 20           |
| L2             | B1          | S3          | 10           |
| L2             | B4          | S5          | 20           |
| L2             | B5          | S4          | 15           |
| L4             | B4          | S4          | 20           |
| L4             | B5          | S4          | 30           |
| L5             | B1          | S2          | 10           |
| L5             | B2          | S5          | 20           |
| L5             | B4          | S5          | 30           |

## 实验步骤

```sql
-- Library Table
CREATE TABLE library (
    library_id TEXT PRIMARY KEY,
    library_name TEXT NOT NULL,
    city TEXT NOT NULL,
    tel TEXT NOT NULL
);
CREATE INDEX idx_library_library_id ON library (library_id);

-- Book Table
CREATE TABLE book (
    book_id TEXT PRIMARY KEY,
    book_name TEXT NOT NULL,
    price DECIMAL(10, 2) NOT NULL
);
CREATE INDEX idx_book_book_id ON book (book_id);

-- Shop Table
CREATE TABLE shop (
    shop_id TEXT PRIMARY KEY,
    shop_name TEXT NOT NULL,
    address TEXT NOT NULL
);
CREATE INDEX idx_shop_shop_id ON shop (shop_id);

-- Book Distribution Table
CREATE TABLE book_distribution (
    library_id TEXT,
    book_id TEXT,
    shop_id TEXT,
    quantity INTEGER NOT NULL,
    PRIMARY KEY (library_id, book_id, shop_id),
    FOREIGN KEY (library_id) REFERENCES library (library_id),
    FOREIGN KEY (book_id) REFERENCES book (book_id),
    FOREIGN KEY (shop_id) REFERENCES shop (shop_id)
);
CREATE INDEX idx_book_distribution_library_id ON book_distribution (library_id);
CREATE INDEX idx_book_distribution_book_id ON book_distribution (book_id);
CREATE INDEX idx_book_distribution_shop_id ON book_distribution (shop_id);
```

```
[2025-11-07 16:48:12] Connected to book_distribution
[2025-11-07 16:48:12] completed in 21 ms
book_distribution> CREATE TABLE library (
                       library_id TEXT PRIMARY KEY,
                       library_name TEXT NOT NULL,
                       city TEXT NOT NULL,
                       tel TEXT NOT NULL
                   )
[2025-11-07 16:48:34] completed in 19 ms
book_distribution> CREATE INDEX idx_library_library_id ON library (library_id)
[2025-11-07 16:48:34] completed in 7 ms
book_distribution> CREATE TABLE book (
                       book_id TEXT PRIMARY KEY,
                       book_name TEXT NOT NULL,
                       price DECIMAL(10, 2) NOT NULL
                   )
[2025-11-07 16:48:34] completed in 10 ms
book_distribution> CREATE INDEX idx_book_book_id ON book (book_id)
[2025-11-07 16:48:34] completed in 6 ms
book_distribution> CREATE TABLE shop (
                       shop_id TEXT PRIMARY KEY,
                       shop_name TEXT NOT NULL,
                       address TEXT NOT NULL
                   )
[2025-11-07 16:48:34] completed in 10 ms
book_distribution> CREATE INDEX idx_shop_shop_id ON shop (shop_id)
[2025-11-07 16:48:34] completed in 7 ms
book_distribution> CREATE TABLE book_distribution (
                       library_id TEXT,
                       book_id TEXT,
                       shop_id TEXT,
                       quantity INTEGER NOT NULL,
                       PRIMARY KEY (library_id, book_id, shop_id),
                       FOREIGN KEY (library_id) REFERENCES library (library_id),
                       FOREIGN KEY (book_id) REFERENCES book (book_id),
                       FOREIGN KEY (shop_id) REFERENCES shop (shop_id)
                   )
[2025-11-07 16:48:34] completed in 11 ms
book_distribution> CREATE INDEX idx_book_distribution_library_id ON book_distribution (library_id)
[2025-11-07 16:48:34] completed in 7 ms
book_distribution> CREATE INDEX idx_book_distribution_book_id ON book_distribution (book_id)
[2025-11-07 16:48:34] completed in 8 ms
book_distribution> CREATE INDEX idx_book_distribution_shop_id ON book_distribution (shop_id)
[2025-11-07 16:48:34] completed in 7 ms
```

```sql
-- Insert into library
INSERT INTO library (library_id, library_name, city, tel) VALUES
('L1', '上海图书馆', '上海', '205800'),
('L2', '上海外文书店', '上海', '310310'),
('L3', '北京图书馆', '北京', '282471'),
('L4', '武汉图书馆', '武汉', '812712'),
('L5', '南京图书馆', '南京', '328173');

-- Insert into book
INSERT INTO book (book_id, book_name, price) VALUES
('B1', '数据库原理', 9.80),
('B2', '系统分析与设计', 8.50),
('B3', '数据库设计', 7.10),
('B4', '计算机原理', 9.60),
('B5', '操作系统', 11.20);

-- Insert into shop
INSERT INTO shop (shop_id, shop_name, address) VALUES
('S1', '北京新华书店', '北京'),
('S2', '上海新华书店', '上海'),
('S3', '上海外文书店', '上海'),
('S4', '湖北新华书店', '武汉'),
('S5', '江苏新华书店', '南京');

-- Insert into book_distribution
INSERT INTO book_distribution (library_id, book_id, shop_id, quantity) VALUES
('L1', 'B1', 'S2', 10),
('L1', 'B2', 'S1', 5),
('L1', 'B3', 'S3', 5),
('L1', 'B4', 'S5', 20),
('L2', 'B1', 'S3', 10),
('L2', 'B4', 'S5', 20),
('L2', 'B5', 'S4', 15),
('L4', 'B4', 'S4', 20),
('L4', 'B5', 'S4', 30),
('L5', 'B1', 'S2', 10),
('L5', 'B2', 'S5', 20),
('L5', 'B4', 'S5', 30);
```

```
[2025-11-07 16:48:47] Connected to book_distribution
[2025-11-07 16:48:47] completed in 25 ms
book_distribution> INSERT INTO library (library_id, library_name, city, tel) VALUES
                   ('L1', '上海图书馆', '上海', '205800'),
                   ('L2', '上海外文书店', '上海', '310310'),
                   ('L3', '北京图书馆', '北京', '282471'),
                   ('L4', '武汉图书馆', '武汉', '812712'),
                   ('L5', '南京图书馆', '南京', '328173')
[2025-11-07 16:48:56] 5 rows affected in 11 ms
book_distribution> INSERT INTO book (book_id, book_name, price) VALUES
                   ('B1', '数据库原理', 9.80),
                   ('B2', '系统分析与设计', 8.50),
                   ('B3', '数据库设计', 7.10),
                   ('B4', '计算机原理', 9.60),
                   ('B5', '操作系统', 11.20)
[2025-11-07 16:48:56] 5 rows affected in 5 ms
book_distribution> INSERT INTO shop (shop_id, shop_name, address) VALUES
                   ('S1', '北京新华书店', '北京'),
                   ('S2', '上海新华书店', '上海'),
                   ('S3', '上海外文书店', '上海'),
                   ('S4', '湖北新华书店', '武汉'),
                   ('S5', '江苏新华书店', '南京')
[2025-11-07 16:48:56] 5 rows affected in 4 ms
book_distribution> INSERT INTO book_distribution (library_id, book_id, shop_id, quantity) VALUES
                   ('L1', 'B1', 'S2', 10),
                   ('L1', 'B2', 'S1', 5),
                   ('L1', 'B3', 'S3', 5),
                   ('L1', 'B4', 'S5', 20),
                   ('L2', 'B1', 'S3', 10),
                   ('L2', 'B4', 'S5', 20),
                   ('L2', 'B5', 'S4', 15),
                   ('L4', 'B4', 'S4', 20),
                   ('L4', 'B5', 'S4', 30),
                   ('L5', 'B1', 'S2', 10),
                   ('L5', 'B2', 'S5', 20),
                   ('L5', 'B4', 'S5', 30)
[2025-11-07 16:48:56] 12 rows affected in 5 ms
```

```sql
-- Create a view to show library book distribution information
CREATE VIEW library_book_distribution_view AS
SELECT 
    l.library_id,
    l.library_name,
    l.city AS library_city,
    b.book_id,
    b.book_name,
    b.price,
    s.shop_id,
    s.shop_name,
    s.address AS shop_address,
    bd.quantity
FROM library l
JOIN book_distribution bd ON l.library_id = bd.library_id
JOIN book b ON bd.book_id = b.book_id
JOIN shop s ON bd.shop_id = s.shop_id;

-- View the data
SELECT * FROM library_book_distribution_view ORDER BY library_name, book_name, shop_name;
```

```
[2025-11-07 16:48:26] Connected to book_distribution
[2025-11-07 16:48:26] completed in 22 ms
book_distribution> -- Create a view to show library book distribution information
                   CREATE VIEW library_book_distribution_view AS
                   SELECT 
                       l.library_id,
                       l.library_name,
                       l.city AS library_city,
                       b.book_id,
                       b.book_name,
                       b.price,
                       s.shop_id,
                       s.shop_name,
                       s.address AS shop_address,
                       bd.quantity
                   FROM library l
                   JOIN book_distribution bd ON l.library_id = bd.library_id
                   JOIN book b ON bd.book_id = b.book_id
                   JOIN shop s ON bd.shop_id = s.shop_id
[2025-11-07 16:49:00] completed in 6 ms
book_distribution.public> SELECT * FROM library_book_distribution_view ORDER BY library_name, book_name, shop_name
[2025-11-07 16:49:00] 12 rows retrieved starting from 1 in 58 ms (execution: 4 ms, fetching: 54 ms)
```

| library\_id | library\_name | library\_city | book\_id | book\_name | price | shop\_id | shop\_name | shop\_address | quantity |
|:----------- |:------------- |:------------- |:-------- |:---------- |:----- |:-------- |:---------- |:------------- |:-------- |
| L1          | 上海图书馆         | 上海            | B1       | 数据库原理      | 9.80  | S2       | 上海新华书店     | 上海            | 10       |
| L1          | 上海图书馆         | 上海            | B3       | 数据库设计      | 7.10  | S3       | 上海外文书店     | 上海            | 5        |
| L1          | 上海图书馆         | 上海            | B2       | 系统分析与设计    | 8.50  | S1       | 北京新华书店     | 北京            | 5        |
| L1          | 上海图书馆         | 上海            | B4       | 计算机原理      | 9.60  | S5       | 江苏新华书店     | 南京            | 20       |
| L2          | 上海外文书店        | 上海            | B5       | 操作系统       | 11.20 | S4       | 湖北新华书店     | 武汉            | 15       |
| L2          | 上海外文书店        | 上海            | B1       | 数据库原理      | 9.80  | S3       | 上海外文书店     | 上海            | 10       |
| L2          | 上海外文书店        | 上海            | B4       | 计算机原理      | 9.60  | S5       | 江苏新华书店     | 南京            | 20       |
| L5          | 南京图书馆         | 南京            | B1       | 数据库原理      | 9.80  | S2       | 上海新华书店     | 上海            | 10       |
| L5          | 南京图书馆         | 南京            | B2       | 系统分析与设计    | 8.50  | S5       | 江苏新华书店     | 南京            | 20       |
| L5          | 南京图书馆         | 南京            | B4       | 计算机原理      | 9.60  | S5       | 江苏新华书店     | 南京            | 30       |
| L4          | 武汉图书馆         | 武汉            | B5       | 操作系统       | 11.20 | S4       | 湖北新华书店     | 武汉            | 30       |
| L4          | 武汉图书馆         | 武汉            | B4       | 计算机原理      | 9.60  | S4       | 湖北新华书店     | 武汉            | 20       |
